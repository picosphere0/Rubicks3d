<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubicks3d | نظرات</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YZ2SVDZSY5"></script>
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <meta name="description" content="Authors : mersad radmehr and parsa batani
    Rubicks3d is a website amied to help you master the art of the rubick cube">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
            <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'text': 'var(--text)',
                        'background': 'var(--background)',
                        'primary': 'var(--primary)',
                        'secondary': 'var(--secondary)',
                        'accent': 'var(--accent)',
                    },
                    fontSize: {
                        sm: '0.57692rem',
                        base: '0.750rem',
                        xl: '1rem',
                        '2xl': '1.333rem',
                        '3xl': '1.777rem',
                        '4xl': '2.369rem',
                        '5xl': '3.158rem',
                    },
                    fontFamily: {
                        heading: 'Vazirmatn',
                        body: 'Vazirmatn',
                    },
                    fontWeight: {
                        normal: '400',
                        bold: '700',
                    },
                }
            }
        }
    </script>
</head>

<body class="bg-background text-text font-bold text-xl text-right">
    <header>
        <nav class="m-16 bg-background border-gray-200">
            <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
              <div class="flex items-center space-x-3 rtl:space-x-reverse w-full md:w-auto justify-around">
                <a href="../index.html" class="flex items-center space-x-3">
                  <img src="../img/Vector.svg" class="h-8" alt="Rubicks3d" />
                </a>
                <button id="menu-toggle" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-text rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200" aria-controls="navbar-default" aria-expanded="false">
                  <span class="sr-only">Open main menu</span>
                  <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
                  </svg>
                </button>
              </div>
              <div class="hidden w-full md:flex md:w-auto justify-evenly" id="navbar-default">
                <ul class="font-medium flex flex-col md:flex-row md:space-x-8 rtl:space-x-reverse">
                  <li>
                    <a href="../blog/index.html" class="block py-2 px-3 rounded text-text bg-blue-700 md:bg-transparent md:text-blue-700 md:p-0">بلاگ</a>
                  </li>
                  <li>
                    <a href="../web.html" class="block py-2 px-3 rounded text-text hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0">روبیک سه بعدی</a>
                  </li>
                  <li>
                    <a href="../reviews/index.html" class="block py-2 px-3 rounded text-text hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0">نظرات</a>
                  </li>
                  <li>
                    <button id="theme-toggle" class="bg-white border-1 border border-primary" style="margin-left: 1rem;">
                      <img src="../img/theme.svg" alt="theme-toggle" class="w-4">
                    </button>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
        <div class="content p-16">
            <h1 class="text-5xl mb-4">نظرات شما برای ما بسیار مهم است</h1>
            <h2 class="text-3xl">و برای همین دلیل یک را صفحه برای نظرات شما ساختیم. لطفا امتاز خود را از 1 تا 10 بدهید</h2>
        </div>
    </header>

    <form id="myForm" method="post" class="flex flex-col items-center gap-3">
        <input class="bg-gray-900 text-center p-4 rounded-3xl w-2/3 md:w-1/3" type="text" name="name" id="name" placeholder="اسم" required>
        <input class="bg-gray-900 text-center p-4 rounded-3xl w-2/3 md:w-1/3" type="text" name="message" id="message" placeholder="پیام" required>
        <input class="bg-gray-900 text-center p-4 rounded-3xl w-2/3 md:w-1/3" type="email" id="email" name="email" placeholder="ایمیل ( اختیاری )">
        <input class="bg-gray-900 text-center p-4 rounded-3xl w-2/3 md:w-1/3" type="number" name="rating" id="rating" placeholder="10/10" required max="10" min="1">
        <input type="submit" value="ارسال" class="btn bg-primary">
    </form>

    <div id="reviews-container" class="mt-32">
        <!-- Reviews will be appended here -->
    </div>

    <footer class="bg-secondary mt-32 bg-opacity-25 border-t-4 border-secondary h-64 flex flex-row-reverse justify-around items-center">
        <div class="right flex flex-col text-center text-2xl ">
            <a href="../blog/index.html">بلاگ</a>
            <a href="index.html">نظرات</a>
            <a href="../web.html">روبیک سه بعدی</a>
        </div>
        <div class="left">
            <img class="w-32" src="../img/Vector.svg" alt="logo">
        </div>
    </footer>

    <script>
        // Fetch reviews from PocketBase and append them to the container
        fetch('https://rubicks3d.pockethost.io/api/collections/form_submissions/records')
            .then(response => response.json())
            .then(data => {
                const reviewsContainer = document.getElementById('reviews-container');
    
                data.items.forEach(review => {
                    const reviewItem = document.createElement('div');
                    reviewItem.classList.add('review-item');
    
                    // Calculate full stars and half stars
                    const fullStars = Math.floor(review.rating / 2);
                    const halfStars = review.rating % 2 >= 1 ? 1 : 0;
                    const totalStars = fullStars + halfStars;
    
                    // Function to wrap text with a maximum of 20 characters per line
                    function wrapText(text) {
                        const maxLength = 20;
                        let wrappedText = '';
                        let words = text.split(' ');
                        let lineLength = 0;
    
                        words.forEach(word => {
                            if (lineLength + word.length > maxLength) {
                                wrappedText += '<br>';
                                lineLength = 0;
                            }
                            wrappedText += word + ' ';
                            lineLength += word.length;
                        });
    
                        return wrappedText.trim();
                    }
    
                    // Create star elements
                    let starsHTML = '';
                    for (let i = 0; i < fullStars; i++) {
                        starsHTML += '<span class="fa fa-star checked"></span>'; // Full star
                    }
                    if (halfStars) {
                        starsHTML += '<span class="fa fa-star-half-alt checked"></span>'; // Half star
                    }
                    for (let i = totalStars; i < 5; i++) {
                        starsHTML += '<span class="fa fa-star"></span>'; // Empty star
                    }
    
                    reviewItem.innerHTML = `
                        <div class="text-blue-500 bg-gray-900 border-secondary border-4 bg-opacity-50 flex flex-col w-max p-8 rounded-2xl transition hover:scale-110">
                            <p class="text-xl text-left">امتیاز: ${starsHTML}</p> 
                            <p class="text-2xl text-left">${wrapText(review.message)}</p>
                            <h3 class="text-3xl text-left">${review.name}</h3>
                        </div>
                    `;
                    reviewsContainer.appendChild(reviewItem);
                });
            })
            .catch(error => {
                console.error('Error fetching reviews:', error);
            });
    
        document.getElementById('myForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent the default form submission
    
            // Collect form data
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
    
            // Send the data to PocketBase
            fetch('https://rubicks3d.pockethost.io/api/collections/form_submissions/records', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(result => {
                console.log('Success:', result);
                alert('Form submitted successfully!');
                // Optionally, refresh the reviews carousel after submitting a new review
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error submitting form: ' + error.message);
            });
        });
    
        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                html.classList.add('light');
            } else {
                html.classList.remove('light');
                html.classList.add('dark');
            }
        }
    
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    </script>
    

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-YZ2SVDZSY5');
    </script>

    <script src="scripts.js"></script>
</body>
</html>
