<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rubicks3d | نظرات</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YZ2SVDZSY5"></script>
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <meta name="description" content="Authors : mersad radmehr and parsa batani
    Rubicks3d is a website amied to help you master the art of the rubick cube">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .swiper-container {
            width: 100%;
            height: 100%;
        }
    
        .swiper-button-next,
        .swiper-button-prev {
            color: var(--text);
        }
    
        .swiper-pagination {
            color: var(--text);
        }
    
        .swiper-navigation-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
    
        .swiper-button-next,
        .swiper-button-prev {
            position: static;
            margin: 0 10px;
        }
    
        .checked {
            color: gold;
        }
    
        /* Grid layout for reviews container */
        #reviews-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 8px;
            padding: 16px;
        }
    
        .review-item {
            width: 100%; /* Ensure all items have the same width */
            background: var(--background);
            padding: 12px;
            border-radius: 16px;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            align-content: flex-start;
    justify-content: center;
    align-items: center;
        }
    
        .review-item:hover {
            transform: scale(1.05);
        }
    </style>
    
    

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'text': 'var(--text)',
                        'background': 'var(--background)',
                        'primary': 'var(--primary)',
                        'secondary': 'var(--secondary)',
                        'accent': 'var(--accent)',
                    },
                    fontSize: {
                        sm: '0.57692rem',
                        base: '0.750rem',
                        xl: '1rem',
                        '2xl': '1.333rem',
                        '3xl': '1.777rem',
                        '4xl': '2.369rem',
                        '5xl': '3.158rem',
                    },
                    fontFamily: {
                        heading: 'Vazirmatn',
                        body: 'Vazirmatn',
                    },
                    fontWeight: {
                        normal: '400',
                        bold: '700',
                    },
                }
            }
        }
    </script>
</head>

<body class="bg-background text-text font-bold text-xl text-right">
    <header>
        <nav class="flex flex-row-reverse justify-around items-center p-16">
            <button id="theme-toggle" class="bg-gray-100 text-white font-bold py-2 px-4 rounded">
                <img src="../img/theme.svg" alt="theme-toggle" class="w-4">
            </button>
            <a href="../blog/index.html">بلاگ</a>
            <a href="../web.html">روبیک سه بعدی</a>
            <a href="../reviews/index.html">نظرات</a>
            <img class="w-16" src="../img/favicon.ico" alt="logo">
        </nav>
        <div class="content p-16">
            <h1 class="text-5xl mb-4">نظرات شما برای ما بسیار مهم است</h1>
            <h2 class="text-3xl">و برای همین دلیل یک را صفحه برای نظرات شما ساختیم. لطفا امتاز خود را از 1 تا 10 بدهید</h2>
        </div>
    </header>

    <form id="myForm" method="post" class="flex flex-col items-center gap-3">
        <input class="bg-gray-900 text-center p-4 rounded-3xl w-2/3 md:w-1/3" type="text" name="name" id="name" placeholder="اسم" required>
        <input class="bg-gray-900 text-center p-4 rounded-3xl w-2/3 md:w-1/3" type="text" name="message" id="message" placeholder="پیام" required>
        <input class="bg-gray-900 text-center p-4 rounded-3xl w-2/3 md:w-1/3" type="email" id="email" name="email" placeholder="ایمیل ( اختیاری )">
        <input class="bg-gray-900 text-center p-4 rounded-3xl w-2/3 md:w-1/3" type="number" name="rating" id="rating" placeholder="10/10" required max="10" min="1">
        <input type="submit" value="ارسال" class="btn bg-primary">
    </form>

    <div id="reviews-container" class="mt-32">
        <!-- Reviews will be appended here -->
    </div>

    <footer class="bg-secondary mt-32 bg-opacity-25 border-t-4 border-secondary h-64 flex flex-row-reverse justify-around items-center">
        <div class="right flex flex-col text-center text-2xl ">
            <a href="../blog/index.html">بلاگ</a>
            <a href="index.html">نظرات</a>
            <a href="../web.html">روبیک سه بعدی</a>
        </div>
        <div class="left">
            <img class="w-32" src="../img/Vector.svg" alt="logo">
        </div>
    </footer>

    <script>
        // Fetch reviews from PocketBase and append them to the container
        fetch('https://rubicks3d.pockethost.io/api/collections/form_submissions/records')
            .then(response => response.json())
            .then(data => {
                const reviewsContainer = document.getElementById('reviews-container');
    
                data.items.forEach(review => {
                    const reviewItem = document.createElement('div');
                    reviewItem.classList.add('review-item');
    
                    // Calculate full stars and half stars
                    const fullStars = Math.floor(review.rating / 2);
                    const halfStars = review.rating % 2 >= 1 ? 1 : 0;
                    const totalStars = fullStars + halfStars;
    
                    // Function to wrap text with a maximum of 20 characters per line
                    function wrapText(text) {
                        const maxLength = 20;
                        let wrappedText = '';
                        let words = text.split(' ');
                        let lineLength = 0;
    
                        words.forEach(word => {
                            if (lineLength + word.length > maxLength) {
                                wrappedText += '<br>';
                                lineLength = 0;
                            }
                            wrappedText += word + ' ';
                            lineLength += word.length;
                        });
    
                        return wrappedText.trim();
                    }
    
                    // Create star elements
                    let starsHTML = '';
                    for (let i = 0; i < fullStars; i++) {
                        starsHTML += '<span class="fa fa-star checked"></span>'; // Full star
                    }
                    if (halfStars) {
                        starsHTML += '<span class="fa fa-star-half-alt checked"></span>'; // Half star
                    }
                    for (let i = totalStars; i < 5; i++) {
                        starsHTML += '<span class="fa fa-star"></span>'; // Empty star
                    }
    
                    reviewItem.innerHTML = `
                        <div class="text-blue-500 bg-gray-900 border-secondary border-4 bg-opacity-50 flex flex-col w-max p-8 rounded-2xl transition hover:scale-110">
                            <p class="text-xl text-left">امتیاز: ${starsHTML}</p> 
                            <p class="text-2xl text-left">${wrapText(review.message)}</p>
                            <h3 class="text-3xl text-left">${review.name}</h3>
                        </div>
                    `;
                    reviewsContainer.appendChild(reviewItem);
                });
            })
            .catch(error => {
                console.error('Error fetching reviews:', error);
            });
    
        document.getElementById('myForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent the default form submission
    
            // Collect form data
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
    
            // Send the data to PocketBase
            fetch('https://rubicks3d.pockethost.io/api/collections/form_submissions/records', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.statusText);
                }
                return response.json();
            })
            .then(result => {
                console.log('Success:', result);
                alert('Form submitted successfully!');
                // Optionally, refresh the reviews carousel after submitting a new review
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error submitting form: ' + error.message);
            });
        });
    
        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                html.classList.add('light');
            } else {
                html.classList.remove('light');
                html.classList.add('dark');
            }
        }
    
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    </script>
    

    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-YZ2SVDZSY5');
    </script>

    <script src="scripts.js"></script>
</body>
</html>
